#!/bin/sh

# Test grepdiff -s/--status option
# According to the documentation, -s should show:
#   + for file additions
#   - for file removals
#   ! for file modifications

. ${top_srcdir-.}/tests/common.sh

cat << EOF > diff
--- /dev/null
+++ newfile
@@ -0,0 +1 @@
+content
--- oldfile
+++ /dev/null
@@ -1 +0,0 @@
-content
--- modified
+++ modified
@@ -1 +1 @@
-old
+new
--- another-modified
+++ another-modified
@@ -1,2 +1,2 @@
 context
-old content
+new content
EOF

# Test additions and deletions (files with 'content' pattern)
${GREPDIFF} -s 'content' diff 2>errors >output || exit 1
[ -s errors ] && exit 1

cat << EOF | cmp - output || exit 1
+ newfile
- oldfile
! another-modified
EOF

# Test modification only (file with 'new' pattern)
${GREPDIFF} -s 'new' diff 2>errors >output2 || exit 1
[ -s errors ] && exit 1

cat << EOF | cmp - output2 || exit 1
! modified
! another-modified
EOF

# Test with --empty-files-as-absent
# File with only additions should be treated as new file
cat << EOF > diff3
--- emptyfile
+++ emptyfile
@@ -0,0 +1 @@
+content
@@ -60 +60 @@
-old
+new
EOF

${GREPDIFF} -s --empty-files-as-absent 'content' diff3 2>errors >output3 || exit 1
[ -s errors ] && exit 1

cat << EOF | cmp - output3 || exit 1
+ emptyfile
EOF
