#!/bin/sh

# This is an interdiff(1) testcase.
# Test: --color option should not break context trimming

. ${top_srcdir-.}/tests/common.sh

# Create test files
cat << EOF > file
line1
line2
line3
line10
line11
line12
EOF

# First patch
cat << EOF > patch1
--- file
+++ file
@@ -1,3 +1,3 @@
 line1
-line2
+MODIFIED2
 line3
EOF

# Second patch
cat << EOF > patch2
--- file
+++ file
@@ -4,3 +4,3 @@
 line10
-line11
+MODIFIED11
 line12
EOF

# Generate interdiff with --color=always
${INTERDIFF} --color=always patch1 patch2 2>errors >result || { cat errors; exit 1; }

# Apply patch1 to create the base state for testing the interdiff
cp file file-with-patch1
${PATCH} file-with-patch1 < patch1 || exit 1

# Test that the interdiff result can be applied cleanly
cp file-with-patch1 file-test
${PATCH} file-test < result || exit 1
